const axios = require('axios');

const OPENAI_API_KEY = process.env.OPENAI_API_KEY;
const OPENAI_BASE_URL = "https://api.openai.com/v1/chat/completions";

async function generateWithOpenAI(prompt, options = {}) {
  try {
    console.log('ЁЯдЦ OpenAI API call started...');
    console.log('ЁЯУК Temperature:', options.temperature ?? 0.7);
    console.log('ЁЯУЭ Max tokens:', options.max_tokens ?? 2000);
    
    const response = await axios.post(OPENAI_BASE_URL, {
      model: options.model || "gpt-4o-mini",
      messages: [
        {
          role: "system",
          content: "You are an expert Hindi cricket journalist and SEO editor. Write engaging, comprehensive cricket content in Hindi with deep knowledge of the game, players, statistics, and cricket culture. Always provide detailed, accurate cricket analysis and compelling storytelling in Hindi."
        },
        {
          role: "user",
          content: prompt
        }
      ],
      temperature: options.temperature ?? 0.7,
      max_tokens: options.max_tokens ?? 2000,
    }, {
      headers: {
        'Authorization': `Bearer ${OPENAI_API_KEY}`,
        'Content-Type': 'application/json'
      },
      timeout: 120000, // 2 minutes for longer articles
    });
    
    const content = response.data?.choices?.[0]?.message?.content || "";
    console.log('тЬЕ OpenAI API call completed, content length:', content.length);
    return content;
  } catch (error) {
    console.error('тЭМ OpenAI API error:', error.message);
    if (error.code === 'ECONNABORTED') {
      throw new Error('Request timeout - article generation took too long. Try again.');
    }
    if (error.response) {
      console.error('Response status:', error.response.status);
      console.error('Response data:', error.response.data);
      throw new Error(`OpenAI API error: ${error.response.data?.error?.message || error.message}`);
    }
    throw error;
  }
}

/* ---------- HINDI CRICKET STATS & EXPERT FUNCTIONS ---------- */

async function fetchHindiCricketStats(playerName, teamName, matchType) {
  // Enhanced Hindi cricket statistics for OpenAI processing
  const statsPrompts = {
    "рд╡рд┐рд░рд╛рдЯ рдХреЛрд╣рд▓реА": {
      career: "рдЕрдВрддрд░реНрд░рд╛рд╖реНрдЯреНрд░реАрдп рдХреНрд░рд┐рдХреЗрдЯ рдореЗрдВ 73 рд╢рддрдХ, рд╕рднреА рдкреНрд░рд╛рд░реВрдкреЛрдВ рдореЗрдВ 26,000+ рд░рди",
      recent: "рдкрд┐рдЫрд▓реЗ 10 ODI рдореЗрдВ рдФрд╕рдд 45.2, рд╕реНрдЯреНрд░рд╛рдЗрдХ рд░реЗрдЯ 89.3",
      records: "8000, 9000, 10000 ODI рд░рди рддрдХ рд╕рдмрд╕реЗ рддреЗрдЬ рдкрд╣реБрдВрдЪрдиреЗ рд╡рд╛рд▓реЗ"
    },
    "рд░реЛрд╣рд┐рдд рд╢рд░реНрдорд╛": {
      career: "31 ODI рд╢рддрдХ, ODI рдореЗрдВ 3 рджреЛрд╣рд░реЗ рд╢рддрдХ",
      recent: "2021 рд╕реЗ рднрд╛рд░рдд рдХреЗ рдХрдкреНрддрд╛рди, рдПрд╢рд┐рдпрд╛ рдХрдк 2023 рдореЗрдВ рд╡рд┐рдЬрдп рджрд┐рд▓рд╛рдИ",
      records: "ODI рдореЗрдВ рд╕рд░реНрд╡реЛрдЪреНрдЪ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╕реНрдХреЛрд░ (264 рд░рди)"
    },
    "рдПрдордПрд╕ рдзреЛрдиреА": {
      career: "10,000+ ODI рд░рди, рд╡рд┐рдХреЗрдЯрдХреАрдкрд░ рдХреЗ рд░реВрдк рдореЗрдВ 350+ рдбрд┐рд╕рдорд┐рд╕рд▓",
      recent: "2020 рдореЗрдВ рдЕрдВрддрд░реНрд░рд╛рд╖реНрдЯреНрд░реАрдп рдХреНрд░рд┐рдХреЗрдЯ рд╕реЗ рд░рд┐рдЯрд╛рдпрд░рдореЗрдВрдЯ",
      records: "рд╕рднреА рддреАрди ICC рдЯреНрд░реЙрдлреА рдЬреАрддрдиреЗ рд╡рд╛рд▓реЗ рдПрдХрдорд╛рддреНрд░ рдХрдкреНрддрд╛рди"
    },
    "рдмрд╛рдмрд░ рдЖрдЬрдо": {
      career: "рд▓рдЧрд╛рддрд╛рд░ рдЯреЙрдк-рдСрд░реНрдбрд░ рдмрд▓реНрд▓реЗрдмрд╛рдЬ, ODI рдореЗрдВ 50+ рдФрд╕рдд",
      recent: "рдкрд╛рдХрд┐рд╕реНрддрд╛рди рдХрдкреНрддрд╛рди, рд╣рд╛рд▓ рдХреА рд╕реАрд░реАрдЬ рдореЗрдВ рд╕рдмрд╕реЗ рдЬреНрдпрд╛рджрд╛ рд░рди рдмрдирд╛рдиреЗ рд╡рд╛рд▓реЗ",
      records: "2000 T20I рд░рди рддрдХ рд╕рдмрд╕реЗ рддреЗрдЬ рдкрд╣реБрдВрдЪрдиреЗ рд╡рд╛рд▓реЗ"
    },
    "рдХреЗрди рд╡рд┐рд▓рд┐рдпрдорд╕рди": {
      career: "рдиреНрдпреВрдЬреАрд▓реИрдВрдб рдХрдкреНрддрд╛рди, 8000+ рдЯреЗрд╕реНрдЯ рд░рди",
      recent: "рдиреНрдпреВрдЬреАрд▓реИрдВрдб рдХреЛ рд╡рд░реНрд▓реНрдб рдЯреЗрд╕реНрдЯ рдЪреИрдВрдкрд┐рдпрдирд╢рд┐рдк рдореЗрдВ рд╡рд┐рдЬрдп рджрд┐рд▓рд╛рдИ",
      records: "рд╡рд░реНрд▓реНрдб рдХрдк рдореЗрдВ рдиреНрдпреВрдЬреАрд▓реИрдВрдб рдмрд▓реНрд▓реЗрдмрд╛рдЬ рдХрд╛ рд╕рд░реНрд╡реЛрдЪреНрдЪ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╕реНрдХреЛрд░"
    }
  };

  const playerStats = statsPrompts[playerName] || {
    career: "рд╕реНрдерд╛рдкрд┐рдд рдЦрд┐рд▓рд╛рдбрд╝реА рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЕрдВрддрд░реНрд░рд╛рд╖реНрдЯреНрд░реАрдп рдЕрдиреБрднрд╡ рд╣реИ",
    recent: "рд╣рд╛рд▓ рдХреЗ рдореИрдЪреЛрдВ рдореЗрдВ рд▓рдЧрд╛рддрд╛рд░ рдкреНрд░рджрд░реНрд╢рди",
    records: "рдЕрдВрддрд░реНрд░рд╛рд╖реНрдЯреНрд░реАрдп рдХреНрд░рд┐рдХреЗрдЯ рдореЗрдВ рдХрдИ рдЙрдкрд▓рдмреНрдзрд┐рдпрд╛рдВ"
  };

  return playerStats;
}

async function generateHindiExpertOpinion(topic, context) {
  try {
    const expertPrompt = `
рдЖрдк рдПрдХ рдХреНрд░рд┐рдХреЗрдЯ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рд╣реИрдВред рдЗрд╕ рдХреНрд░рд┐рдХреЗрдЯ рд╡рд┐рд╖рдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдпрдерд╛рд░реНрдерд╡рд╛рджреА, рдЕрдВрддрд░реНрджреГрд╖реНрдЯрд┐рдкреВрд░реНрдг рдЙрджреНрдзрд░рдг рджреЗрдВред рдЗрд╕реЗ рдРрд╕рд╛ рдмрдирд╛рдПрдВ рдЬреИрд╕реЗ рд╣рд░реНрд╖рд╛ рднреЛрдЧрд▓реЗ, рдЗрдпрд╛рди рдмрд┐рд╢рдк, рдпрд╛ рд░рд╡рд┐ рд╢рд╛рд╕реНрддреНрд░реА рдХрд╣рддреЗ рд╣реЛрдВред

рд╡рд┐рд╖рдп: ${topic}
рд╕рдВрджрд░реНрдн: ${context}

рдХреЗрд╡рд▓ рдЙрджреНрдзрд░рдг рдЪрд┐рд╣реНрдиреЛрдВ рдореЗрдВ рдкреНрд░рддреНрдпрдХреНрд╖ рдЙрджреНрдзрд░рдг рд▓реМрдЯрд╛рдПрдВред рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рдмрдирд╛рдПрдВ:
- рдЕрдзрд┐рдХрддрдо 1-2 рд╡рд╛рдХреНрдп
- рдЕрдВрддрд░реНрджреГрд╖реНрдЯрд┐рдкреВрд░реНрдг рдФрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдгрд╛рддреНрдордХ
- рдХреНрд░рд┐рдХреЗрдЯ рд╢рдмреНрджрд╛рд╡рд▓реА рдХрд╛ рдкреНрд░рд╛рдХреГрддрд┐рдХ рдЙрдкрдпреЛрдЧ
- рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдЖрд╡рд╛рдЬ рдХреА рддрд░рд╣ рд▓рдЧреЗ
- рдХреЛрдИ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ (рдХреЗрд╡рд▓ рдЙрджреНрдзрд░рдг)

рдЙрджрд╛рд╣рд░рдг: "рдЬрд┐рд╕ рддрд░рд╣ рд╕реЗ рд╡рд╣ рдЕрдм рд╢реЙрд░реНрдЯ рдмреЙрд▓ рдЦреЗрд▓ рд░рд╣реЗ рд╣реИрдВ, рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЙрдирдХреЗ рдЦреЗрд▓ рдореЗрдВ рдЖрддреНрдорд╡рд┐рд╢реНрд╡рд╛рд╕ рд╡рд╛рдкрд╕ рдЖ рдЧрдпрд╛ рд╣реИред"
`;

    const quote = await generateWithOpenAI(expertPrompt, { 
      temperature: 0.8, 
      max_tokens: 100 
    });
    
    return quote.trim().replace(/^["']|["']$/g, '');
  } catch (error) {
    console.error('Error generating Hindi expert opinion:', error);
    return "рд╕реНрдерд┐рддрд┐рдпрд╛рдВ рдЪреБрдиреМрддреАрдкреВрд░реНрдг рд▓рдЧ рд░рд╣реА рд╣реИрдВ рд▓реЗрдХрд┐рди рдЦрд┐рд▓рд╛рдбрд╝рд┐рдпреЛрдВ рдиреЗ рд╕реНрдерд┐рддрд┐ рдХреЗ рдЕрдиреБрдХреВрд▓ рдЦреБрдж рдХреЛ рдврд╛рд▓ рд▓рд┐рдпрд╛ рд╣реИред";
  }
}

async function generateHindiSocialMediaReactions(articleTitle, keyEvent) {
  try {
    const socialPrompt = `
рдЗрд╕ рдХреНрд░рд┐рдХреЗрдЯ рд╕рдорд╛рдЪрд╛рд░ рдХреЗ рд▓рд┐рдП 5 рдпрдерд╛рд░реНрдерд╡рд╛рджреА рд╕реЛрд╢рд▓ рдореАрдбрд┐рдпрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ (X/Twitter рд╢реИрд▓реА) рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВред рдЙрдиреНрд╣реЗрдВ рдРрд╕рд╛ рдмрдирд╛рдПрдВ рдЬреИрд╕реЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХреНрд░рд┐рдХреЗрдЯ рдкреНрд░рд╢рдВрд╕рдХ рд▓рд┐рдЦрддреЗ рд╣реЛрдВред

рд▓реЗрдЦ: ${articleTitle}
рдореБрдЦреНрдп рдШрдЯрдирд╛: ${keyEvent}

рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ:
- 5 рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ
- рднрд╛рд╡рдирд╛рдУрдВ рдХрд╛ рдорд┐рд╢реНрд░рдг (рдЙрддреНрд╕рд╛рд╣, рдЖрд▓реЛрдЪрдирд╛, рд╡рд┐рд╢реНрд▓реЗрд╖рдг, рд╣рд╛рд╕реНрдп, рд╕рдорд░реНрдерди)
- рдЖрдХрд╕реНрдорд┐рдХ, рд╕реЛрд╢рд▓ рдореАрдбрд┐рдпрд╛ рднрд╛рд╖рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ
- рд╣реИрд╢рдЯреИрдЧ рдХрд╛ рдкреНрд░рд╛рдХреГрддрд┐рдХ рдЙрдкрдпреЛрдЧ
- рдкреНрд░рддреНрдпреЗрдХ рдореЗрдВ 1-2 рдкрдВрдХреНрддрд┐рдпрд╛рдВ
- рд╡рд┐рднрд┐рдиреНрди рджреГрд╖реНрдЯрд┐рдХреЛрдгреЛрдВ рд╕реЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХреНрд░рд┐рдХреЗрдЯ рдкреНрд░рд╢рдВрд╕рдХреЛрдВ рдХреА рддрд░рд╣ рд▓рдЧреЗ
- рдХреБрдЫ рд╕рдВрдХреНрд╖рд┐рдкреНрддрд╛рдХреНрд╖рд░ рдФрд░ рдЗрдореЛрдЬреА рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ
- рдЙрдиреНрд╣реЗрдВ рдЯреНрд░реЗрдВрдбрд┐рдВрдЧ рдФрд░ рдпрдерд╛рд░реНрдерд╡рд╛рджреА рдмрдирд╛рдПрдВ

рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ "тАв " рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реБрдП рдирдИ рдкрдВрдХреНрддрд┐ рдкрд░ рдкреНрд░рд╛рд░реВрдкрд┐рдд рдХрд░реЗрдВ
рдЙрджрд╛рд╣рд░рдг: тАв "рдЖрдЦрд┐рд░рдХрд╛рд░! рд╕рджрд┐рдпреЛрдВ рд╕реЗ рдЗрд╕ рдкрд▓ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд░рд╣реЗ рдереЗ ЁЯПП #рдХреНрд░рд┐рдХреЗрдЯ #рдЬреАрдд"

рдХреЗрд╡рд▓ 5 рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рд▓реМрдЯрд╛рдПрдВ, рдФрд░ рдХреБрдЫ рдирд╣реАрдВред
`;

    const reactions = await generateWithOpenAI(socialPrompt, { 
      temperature: 0.9, 
      max_tokens: 300 
    });
    
    return reactions.split('\n').filter(line => line.trim().startsWith('тАв')).slice(0, 5);
  } catch (error) {
    console.error('Error generating Hindi social reactions:', error);
    return [
      "тАв рдХреНрдпрд╛ рдореИрдЪ рдерд╛! рдЗрд╕реАрд▓рд┐рдП рд╣рдо рдХреНрд░рд┐рдХреЗрдЯ рд╕реЗ рдкреНрдпрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ ЁЯПП",
      "тАв рдЖрдЦрд┐рд░рдХрд╛рд░ рдЯреАрдо рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЕрдЪреНрдЫреА рдЦрдмрд░! #рдХреНрд░рд┐рдХреЗрдЯ",
      "тАв рдЗрд╕ рдкрд▓ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд░рд╣реЗ рдереЗ! рд╢рд╛рдирджрд╛рд░ рдкреНрд░рджрд░реНрд╢рди ЁЯТк",
      "тАв рдЦрд┐рд▓рд╛рдбрд╝рд┐рдпреЛрдВ рдХреЛ рдорд╛рдпрдиреЗ рдХреЗ рд╕рдордп рдЖрдЧреЗ рдЖрддреЗ рджреЗрдЦрдирд╛ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд▓рдЧрд╛",
      "тАв рдпрд╣ рд╕реАрд░реАрдЬ рдХреЗ рд▓рд┐рдП рд╕рдм рдХреБрдЫ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ! #рдЧреЗрдордЪреЗрдВрдЬрд░"
    ];
  }
}

/* ---------- HINDI CRICKET-SPECIFIC PROMPTS ---------- */

function buildHindiCricketPrePublishPrompt({ title, description, body }) {
  return `
рдЖрдк рдПрдХ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рд╣рд┐рдВрджреА рдХреНрд░рд┐рдХреЗрдЯ рдкрддреНрд░рдХрд╛рд░ рдФрд░ SEO рд╕рдВрдкрд╛рджрдХ рд╣реИрдВред рдЗрд╕ рдХреНрд░рд┐рдХреЗрдЯ рд╕рдорд╛рдЪрд╛рд░ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ рдФрд░ рд╡реНрдпрд╛рдкрдХ SEO рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ рдкреНрд░рджрд╛рди рдХрд░реЗрдВред

рдХреЗрд╡рд▓ рдЗрди рдлреАрд▓реНрдбреНрд╕ рдХреЛ рд╕рд╛рджреЗ рдкрд╛рда рдореЗрдВ рд▓реМрдЯрд╛рдПрдВ (рдХреЛрдИ JSON рдирд╣реАрдВ, рдХреЛрдИ markdown рдирд╣реАрдВ)ред рдкреНрд░рддреНрдпреЗрдХ рдХреЛ рдПрдХ рдкрдВрдХреНрддрд┐ рдкрд░ рд░рдЦреЗрдВ Outline рдХреЛ рдЫреЛрдбрд╝рдХрд░ рдЬреЛ рдХрдИ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдореЗрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

1) RECOMMENDED TITLE:
2) RECOMMENDED META DESCRIPTION:
3) RECOMMENDED SLUG: (kebab-case, short)
4) OUTLINE: (use lines like "H2: ..." and "H3: ...")
5) KEYWORDS:
- Primary: ...
- Secondary: ...
- Tertiary: ...
- Long-tail: ...
- Trending: ...

рдХреНрд░рд┐рдХреЗрдЯ рд╕рдорд╛рдЪрд╛рд░ рдХреЗ рд▓рд┐рдП рдЙрдиреНрдирдд SEO рдирд┐рдпрдо:
- рдХреЗрд╡рд▓ рдЗрдирдкреБрдЯ рд╕реЗ рддрдереНрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (рдХреЛрдИ рдЖрд╡рд┐рд╖реНрдХреГрдд рд╕реНрдХреЛрд░/рдЙрджреНрдзрд░рдг/рджрд┐рдирд╛рдВрдХ/рд╕реНрдерд╛рди рдирд╣реАрдВ)
- рд╢реАрд░реНрд╖рдХ рдХреЛ рдЖрдХрд░реНрд╖рдХ рдФрд░ рдХреНрд░рд┐рдХреЗрдЯ-рд╡рд┐рд╢рд┐рд╖реНрдЯ рдмрдирд╛рдПрдВ (рдЯреАрдо рдирд╛рдо, рдореИрдЪ рдкреНрд░рдХрд╛рд░, рдореБрдЦреНрдп рдкрд░рд┐рдгрд╛рдо рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ)
- рдореЗрдЯрд╛ рд╡рд┐рд╡рд░рдг рдореБрдЦреНрдп рдХреНрд░рд┐рдХреЗрдЯ рдХрд╣рд╛рдиреА рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдЬрд┐рдЬреНрдЮрд╛рд╕рд╛ рдкреИрджрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП
- рдЖрдЙрдЯрд▓рд╛рдЗрди рдЙрдиреНрдирдд рдХреНрд░рд┐рдХреЗрдЯ рдкрддреНрд░рдХрд╛рд░рд┐рддрд╛ рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП:
  * H2: рдмреНрд░реЗрдХрд┐рдВрдЧ рдиреНрдпреВрдЬ рд╕рд╛рд░рд╛рдВрд╢ (40-60 рд╢рдмреНрдж)
  * H2: рдореИрдЪ/рдШрдЯрдирд╛ рд╡рд┐рд╡рд░рдг
  * H2: рдореБрдЦреНрдп рдЦрд┐рд▓рд╛рдбрд╝реА рдкреНрд░рджрд░реНрд╢рди
  * H2: рд╕рд╛рдВрдЦреНрдпрд┐рдХреАрдп рд╡рд┐рд╢реНрд▓реЗрд╖рдг
  * H2: рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдЕрдВрддрд░реНрджреГрд╖реНрдЯрд┐
  * H2: рдкреНрд░рд╢рдВрд╕рдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдФрд░ рд╕реЛрд╢рд▓ рдореАрдбрд┐рдпрд╛ рдмрдЬрд╝
  * H2: рдЖрдЧреЗ рдХреНрдпрд╛ рд╣реЛрдЧрд╛
- 5 рд╡рд┐рд╡рд┐рдз рдХреАрд╡рд░реНрдб рдкреНрд░рджрд╛рди рдХрд░реЗрдВ: рдкреНрд░рд╛рдердорд┐рдХ (рдореБрдЦреНрдп рд╡рд┐рд╖рдп), рджреНрд╡рд┐рддреАрдпрдХ (рд╕рдВрдмрдВрдзрд┐рдд рд╢рдмреНрдж), рддреГрддреАрдпрдХ (рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд┐рд╡рд░рдг), рд▓реЙрдиреНрдЧ-рдЯреЗрд▓ (рд╡рд┐рд╕реНрддреГрдд рд╡рд╛рдХреНрдпрд╛рдВрд╢), рдЯреНрд░реЗрдВрдбрд┐рдВрдЧ (рд╡рд░реНрддрдорд╛рди рдмрдЬрд╝рд╡рд░реНрдбреНрд╕)
- рд╣рд┐рдВрджреА рдЖрдЙрдЯрдкреБрдЯ
- рдЖрдХрд░реНрд╖рдХ рдФрд░ рд╡реНрдпрд╛рдкрдХ рдмрдиреЗрдВ

рдЗрдирдкреБрдЯ
рд╢реАрд░реНрд╖рдХ: ${title || ""}
рд╡рд┐рд╡рд░рдг: ${description || ""}
рд╕рд╛рдордЧреНрд░реА:
${body || ""}
`.trim();
}

function buildHindiCricketRewriteBodyHtmlPrompt({
  rawTitle,
  rawDescription,
  rawBody,
  recTitle,
  recMeta,
  recOutline,
  recPrimary,
  recSecondary,
  recTertiary,
  recLongtail,
  recTrending,
}) {
  return `
рдЖрдк рдПрдХ рдЕрднрд┐рдЬрд╛рддреНрдп рд╣рд┐рдВрджреА рдХреНрд░рд┐рдХреЗрдЯ рдкрддреНрд░рдХрд╛рд░ рд╣реИрдВ рдЬреЛ рдПрдХ рдкреНрд░реАрдорд┐рдпрдо рд╕реНрдкреЛрд░реНрдЯреНрд╕ рдкреНрд░рдХрд╛рд╢рди рдХреЗ рд▓рд┐рдП рд▓рд┐рдЦ рд░рд╣реЗ рд╣реИрдВред рдЖрдкрдХрд╛ рд▓рдХреНрд╖реНрдп рдПрдХ рдЖрдХрд░реНрд╖рдХ, рдХрдерд╛-рд╕рдореГрджреНрдз рдХреНрд░рд┐рдХреЗрдЯ рд▓реЗрдЦ рдмрдирд╛рдирд╛ рд╣реИ рдЬреЛ рд╕рд╛рдзрд╛рд░рдг рдкреБрдирд░реНрд▓реЗрдЦрди рд╕реЗ рдЖрдЧреЗ рдЬрд╛рддрд╛ рд╣реИред

рдЙрдиреНрдирдд рд▓реЗрдЦрди рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ:

1. рдкреБрдирд░реНрд▓реЗрдЦрди рдФрд░ рдХрдерд╛ рдХреЛ рдКрдВрдЪрд╛ рдЙрдард╛рдПрдВ:
- рдкрд░реНрдпрд╛рдпрд╡рд╛рдЪреА рд╕реНрд╡реИрдкрд┐рдВрдЧ рд╕реЗ рдЖрдЧреЗ рдЬрд╛рдПрдВ - рдмреЗрд╣рддрд░ рдкреНрд░рд╡рд╛рд╣ рдФрд░ рдкреНрд░рднрд╛рд╡ рдХреЗ рд▓рд┐рдП рд╡рд╛рдХреНрдпреЛрдВ рдФрд░ рдкреИрд░рд╛рдЧреНрд░рд╛рдлреЛрдВ рдХреЛ рдкреБрдирд░реНрдЧрдард┐рдд рдХрд░реЗрдВ
- рд╣рд░реНрд╖рд╛ рднреЛрдЧрд▓реЗ рдпрд╛ рдЬреИрд░реЛрдб рдХрд┐рдореНрдмрд░ рдЬреИрд╕реЗ рдкрддреНрд░рдХрд╛рд░реЛрдВ рдХреА рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдХрд░реНрд╖рдХ рдХрдерд╛ рдЖрд╡рд╛рдЬрд╝ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░реЗрдВ
- рдЬрд╣рд╛рдВ рдЙрдкрдпреБрдХреНрдд рд╣реЛ, рдХрдерд╛рддреНрдордХ рд▓реАрдбреНрд╕, рдмрдпрд╛рдирдмрд╛рдЬреА рдкреНрд░рд╢реНрдиреЛрдВ рдФрд░ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЕрдВрддрд░реНрджреГрд╖реНрдЯрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
- рд╕рдмрд╕реЗ рдиреНрдпреВрдЬрд╝рд╡рд░реНрдереА рдХреЛрдг рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдВ рдФрд░ рдЙрд╕рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░реЗрдВ, рднрд▓реЗ рд╣реА рдореВрд▓ рдиреЗ рдЗрд╕реЗ рдХрдо рдЖрдВрдХрд╛ рд╣реЛ
- рдкрд╛рдардХреЛрдВ рдХреЛ рд╢реБрд░реБрдЖрдд рд╕реЗ рдЕрдВрдд рддрдХ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдХрд╣рд╛рдиреА рдЪрд╛рдк рдмрдирд╛рдПрдВ

2. рд╡рд┐рд╢реЗрд╖ рдореВрд▓реНрдп рдХреЗ рд╕рд╛рде рдмрдврд╝рд╛рдПрдВ:
- рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рдХреНрд░рд┐рдХреЗрдЯ рдЖрдВрдХрдбрд╝реЗ рдФрд░ рдбреЗрдЯрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЬреЛрдбрд╝реЗрдВ (рдЦрд┐рд▓рд╛рдбрд╝реА рд░рд┐рдХреЙрд░реНрдб, рдЯреАрдо рдкреНрд░рджрд░реНрд╢рди, рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рд╕рдВрджрд░реНрдн)
- рдЦрд┐рд▓рд╛рдбрд╝рд┐рдпреЛрдВ, рдХреЛрдЪреЛрдВ рдпрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдХреЛрдВ рд╕реЗ рддрд╛рд░реНрдХрд┐рдХ, рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдЕрдиреБрдорд╛рдирд┐рдд рдЙрджреНрдзрд░рдг рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ
- рдЕрдзрд┐рдХ рд╕рдореГрджреНрдз рдкреГрд╖реНрдарднреВрдорд┐ рдФрд░ рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рд╕рдВрджрд░реНрдн рдкреНрд░рджрд╛рди рдХрд░реЗрдВ рдЬреЛ рдореВрд▓ рдиреЗ рдЫреЛрдбрд╝рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ
- рд╕рдорд╛рди рдЕрддреАрдд рдХреА рдХреНрд░рд┐рдХреЗрдЯ рдШрдЯрдирд╛рдУрдВ рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛рддреНрдордХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЬреЛрдбрд╝реЗрдВ
- рдкреНрд░рджрд░реНрд╢рди рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рд░реБрдЭрд╛рди рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ

3. рд╕рдВрд░рдЪрдирд╛ рдФрд░ SEO рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░реЗрдВ:
- рд╢рдХреНрддрд┐рд╢рд╛рд▓реА, рдХреАрд╡рд░реНрдб-рд╕рдореГрджреНрдз рд╢реАрд░реНрд╖рдХ рдФрд░ рддреАрдЦрд╛ рд╢реБрд░реБрдЖрддреА рдкреИрд░рд╛рдЧреНрд░рд╛рдл (40-60 рд╢рдмреНрдж) рддреИрдпрд╛рд░ рдХрд░реЗрдВ
- рд╕реНрдкрд╖реНрдЯ, рд╡рд░реНрдгрдирд╛рддреНрдордХ рдЙрдкрд╢реАрд░реНрд╖рдХ (H2, H3) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
- рд╕рднреА 5 рдХреАрд╡рд░реНрдбреНрд╕ рдХреЛ рдкреНрд░рд╛рдХреГрддрд┐рдХ рд░реВрдк рд╕реЗ рдПрдХреАрдХреГрдд рдХрд░реЗрдВ: ${recPrimary || ""}, ${recSecondary || ""}, ${recTertiary || ""}, ${recLongtail || ""}, ${recTrending || ""}
- рдбрд┐рдЬрд┐рдЯрд▓ рдкрдардиреАрдпрддрд╛ рдХреЗ рд▓рд┐рдП рдкреИрд░рд╛рдЧреНрд░рд╛рдл рдЫреЛрдЯреЗ рд░рдЦреЗрдВ (рдЕрдзрд┐рдХрддрдо 2-3 рдкрдВрдХреНрддрд┐рдпрд╛рдВ)
- рдЖрдВрдХрдбрд╝реЗ рдФрд░ рдореБрдЦреНрдп рддрдереНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдмреБрд▓реЗрдЯ рдкреЙрдЗрдВрдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ

4. рдирдП рдЕрдиреБрднрд╛рдЧ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ:
- рдпрдерд╛рд░реНрдерд╡рд╛рджреА рд╕реЛрд╢рд▓ рдореАрдбрд┐рдпрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рдЬреЛрдбрд╝реЗрдВ (X/Twitter, Instagram рд╕реЗ 3-5 рдЯреНрд░реЗрдВрдбрд┐рдВрдЧ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ)
- рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдФрд░ рдЙрджреНрдзрд░рдг рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ
- рд╕рд╛рдВрдЦреНрдпрд┐рдХреАрдп рд╕рдВрджрд░реНрдн рдФрд░ рдбреЗрдЯрд╛ рдЕрдВрддрд░реНрджреГрд╖реНрдЯрд┐ рдкреНрд░рджрд╛рди рдХрд░реЗрдВ
- рдкреНрд░рд╢рдВрд╕рдХ рдкрд░рд┐рдкреНрд░реЗрдХреНрд╖реНрдп рдФрд░ рд╕рдореБрджрд╛рдп рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рдЬреЛрдбрд╝реЗрдВ

рдПрдВрдЯреА-рдПрдЖрдИ рдбрд┐рдЯреЗрдХреНрд╢рди рдирд┐рдпрдо (рдЙрдиреНрдирдд):
- 100% рдореВрд▓ рд╕рд╛рдордЧреНрд░реА рд▓рд┐рдЦреЗрдВ - рдЕрдкрдиреЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдкреБрдирд░реНрд▓реЗрдЦрди рдХрд░реЗрдВ
- рдХрдЪреНрдЪреА рд╕рд╛рдордЧреНрд░реА рд╕реЗ рдХрднреА рднреА рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдпрд╛ рд╡рд╛рдХреНрдп рд╕реАрдзреЗ рдХреЙрдкреА рди рдХрд░реЗрдВ
- рд╡рд╛рдХреНрдп рдХреА рд▓рдВрдмрд╛рдИ рдХреЛ рдирд╛рдЯрдХреАрдп рд░реВрдк рд╕реЗ рдмрджрд▓реЗрдВ (3-рд╢рдмреНрдж рдХреА рдкрдВрдЪреА рд╕реНрдЯреЗрдЯрдореЗрдВрдЯреНрд╕, рдлрд┐рд░ 25-рд╢рдмреНрдж рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдгрд╛рддреНрдордХ рд╡рд╛рдХреНрдп)
- рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рд╢рдмреНрдж рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЕрдиреБрдорд╛рдирд┐рдд рдкреИрдЯрд░реНрди рд╕реЗ рдмрдЪреЗрдВ
- рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдорд╛рдирд╡реАрдп рддрддреНрд╡ рдЬреЛрдбрд╝реЗрдВ: рдкреНрд░рд╛рдХреГрддрд┐рдХ рдЕрдкреВрд░реНрдгрддрд╛рдПрдВ, рд╡рд┐рд╡рд┐рдз рдЧрддрд┐, рднрд╛рд╡рдирд╛рддреНрдордХ рд╡рд┐рдЪрд░рдг
- рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд┐рд╡рд░рдг, рджрд┐рдирд╛рдВрдХ, рд╕реНрдХреЛрд░ рдФрд░ рдХрдард┐рди рддрдереНрдп рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ
- рдЬрдм рд╕рдВрднрд╡ рд╣реЛ, рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЗ рд╕рд╛рде рдирд╛рдорд┐рдд рдЙрджреНрдзрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
- рдПрдЖрдИ-рдЬреЗрдирд░реЗрдЯреЗрдб рд╕рд╛рдордЧреНрд░реА рдХреА рддрд░рд╣ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рдкреЗрд╢реЗрд╡рд░ рд╕реНрдкреЛрд░реНрдЯреНрд╕ рдкрддреНрд░рдХрд╛рд░рд┐рддрд╛ рдХреА рддрд░рд╣ рд▓рдЧреЗ

рднрд╛рд╖рд╛ рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ:
- рдЖрдХрд░реНрд╖рдХ рд▓реЗрдХрд┐рди рд╕реБрд▓рдн рд╣рд┐рдВрджреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (12рд╡реАрдВ рдХрдХреНрд╖рд╛ рд╕реНрддрд░)
- рддрдХрдиреАрдХреА рдХреНрд░рд┐рдХреЗрдЯ рд╢рдмреНрджреЛрдВ рдХреЛ рд░реЛрдЬрдорд░реНрд░рд╛ рдХреА рднрд╛рд╖рд╛ рдХреЗ рд╕рд╛рде рдорд┐рд▓рд╛рдПрдВ
- рдЖрдХрд░реНрд╖рдХ, рдкрдардиреАрдп рд╕рд╛рдордЧреНрд░реА рдмрдирд╛рдПрдВ рдЬреЛ рдкреЗрд╢реЗрд╡рд░ рдорд╛рдирдХреЛрдВ рдХреЛ рдмрдирд╛рдП рд░рдЦреЗ
- рд╕рдХреНрд░рд┐рдп рдЖрд╡рд╛рдЬрд╝ рдФрд░ рдЧрддрд┐рд╢реАрд▓ рд╡рд╛рдХреНрдп рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ

SEO рдЖрдЙрдЯрд▓рд╛рдЗрди рдХрд╛ рдХрдбрд╝рд╛рдИ рд╕реЗ рдкрд╛рд▓рди рдХрд░реЗрдВ:
${recOutline || ""}

рдорд╣рддреНрд╡рдкреВрд░реНрдг: рдЖрдкрдХреЛ рдКрдкрд░ рджрд┐рдП рдЧрдП рдЖрдЙрдЯрд▓рд╛рдЗрди рд╕реЗ рд╕рдЯреАрдХ H2 рдФрд░ H3 рд╢реАрд░реНрд╖рдХреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред
- рдЖрдЙрдЯрд▓рд╛рдЗрди рдореЗрдВ рджрд┐рдП рдЧрдП рд╕рдЯреАрдХ рд╢реАрд░реНрд╖рдХ рдкрд╛рда рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
- рдЗрд╕ рдЖрдЙрдЯрд▓рд╛рдЗрди рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЕрдкрдиреЗ рд▓реЗрдЦ рдХреЛ рд╕рдВрд░рдЪрд┐рдд рдХрд░реЗрдВ
- рдЖрдЙрдЯрд▓рд╛рдЗрди рд╕реЗ рдХреЛрдИ рднреА рдЕрдиреБрднрд╛рдЧ рди рдЫреЛрдбрд╝реЗрдВ
- рдЖрдЙрдЯрд▓рд╛рдЗрди рдореЗрдВ рдирд╣реАрдВ рд╣реИ, рдРрд╕реЗ рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрдиреБрднрд╛рдЧ рди рдЬреЛрдбрд╝реЗрдВ

рдЙрдиреНрдирдд рд▓реЗрдЦрди рд╢реИрд▓реА:
1. рддреБрд░рдВрдд рдкрд╛рдардХ рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЖрдХрд░реНрд╖рдХ рд▓реАрдб рдХреЗ рд╕рд╛рде рд╢реБрд░реБрдЖрдд рдХрд░реЗрдВ
2. рд╡рд┐рд╡рд┐рдз рд╡рд╛рдХреНрдп рд▓рдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ: рдЫреЛрдЯреА рдкрдВрдЪреА рд╕реНрдЯреЗрдЯрдореЗрдВрдЯреНрд╕ рдХреЗ рд╕рд╛рде рд▓рдВрдмреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдгрд╛рддреНрдордХ рд╡рд╛рдХреНрдпреЛрдВ рдХреЛ рдорд┐рд▓рд╛рдПрдВ
3. рдХрдард┐рди рдбреЗрдЯрд╛ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ: рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЖрдВрдХрдбрд╝реЗ, рд░рд┐рдХреЙрд░реНрдбреНрд╕, рдФрд╕рдд, рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рддреБрд▓рдирд╛рдПрдВ
4. рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдЖрд╡рд╛рдЬрд╝реЗрдВ рдЬреЛрдбрд╝реЗрдВ: рдХреЛрдЪреЛрдВ, рдЦрд┐рд▓рд╛рдбрд╝рд┐рдпреЛрдВ рдпрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдХреЛрдВ рд╕реЗ рдпрдерд╛рд░реНрдерд╡рд╛рджреА рдЙрджреНрдзрд░рдг рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ
5. рдХрдерд╛ рдкреНрд░рд╡рд╛рд╣ рдмрдирд╛рдПрдВ: рдкреВрд░реЗ рд▓реЗрдЦ рдореЗрдВ рддрдирд╛рд╡, рдЙрддреНрд╕рд╛рд╣ рдФрд░ рдЬреБрдбрд╝рд╛рд╡ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВ
6. рднрд╛рд╡рдирд╛рддреНрдордХ рдмреБрджреНрдзрд┐рдорддреНрддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ: рдШрдЯрдирд╛ рдХреЗ рдирд╛рдЯрдХ рдФрд░ рдорд╣рддреНрд╡ рдХреЛ рдкрдХрдбрд╝реЗрдВ
7. рд╕рдВрджрд░реНрдн рдкреНрд░рджрд╛рди рдХрд░реЗрдВ: рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рдкреГрд╖реНрдарднреВрдорд┐, рдирд┐рд╣рд┐рддрд╛рд░реНрде рдФрд░ рд╡реНрдпрд╛рдкрдХ рдорд╣рддреНрд╡
8. рдкреНрд░рд╢рдВрд╕рдХ рдкрд░рд┐рдкреНрд░реЗрдХреНрд╖реНрдп рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ: рд╕реЛрд╢рд▓ рдореАрдбрд┐рдпрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рдФрд░ рд╕рдореБрджрд╛рдп рднрд╛рд╡рдирд╛
9. рдЖрдЧреЗ рджреЗрдЦрдиреЗ рд╡рд╛рд▓реЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рдХрд░реЗрдВ: рднрд╡рд┐рд╖реНрдп рдХреЗ рдореИрдЪреЛрдВ/рдШрдЯрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХрд╛ рдХреНрдпрд╛ рдорддрд▓рдм рд╣реИ

HTML рдкреНрд░рд╛рд░реВрдк:
- рдХреЗрд╡рд▓ **HTML BODY** рд▓реМрдЯрд╛рдПрдВ (рдХреЛрдИ <html>, рдХреЛрдИ <head>, рдХреЛрдИ <body> рдЯреИрдЧ рдирд╣реАрдВ)
- рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ: <h1>, <h2>, <h3>, <p>, <ul>, <li>, <blockquote>, <strong>, <em>
- <h1>${recTitle || ""}</h1> рд╕реЗ рд╢реБрд░реБрдЖрдд рдХрд░реЗрдВ
- рдКрдкрд░ рджрд┐рдП рдЧрдП рдЖрдЙрдЯрд▓рд╛рдЗрди рд╕реЗ рд╕рдЯреАрдХ H2 рдФрд░ H3 рд╢реАрд░реНрд╖рдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
- рд╡рд┐рд╡рд┐рдз рд▓рдВрдмрд╛рдИ рдХреЗ рдкреНрд░рд╛рдХреГрддрд┐рдХ рдкреНрд░рд╡рд╛рд╣ рд╡рд╛рд▓реЗ рдкреИрд░рд╛рдЧреНрд░рд╛рдл рд▓рд┐рдЦреЗрдВ
- рдЦрд┐рд▓рд╛рдбрд╝реА рдирд╛рдореЛрдВ рдФрд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЖрдВрдХрдбрд╝реЛрдВ рдХреЗ рд▓рд┐рдП <strong> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
- рдЖрдВрдХрдбрд╝реЗ рдФрд░ рдореБрдЦреНрдп рдмрд┐рдВрджреБрдУрдВ рдХреЗ рд▓рд┐рдП <ul><li> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
- рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдЙрджреНрдзрд░рдгреЛрдВ рдФрд░ рд╕реЛрд╢рд▓ рдореАрдбрд┐рдпрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП <blockquote> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ

рд▓рдХреНрд╖реНрдп SEO рдХреАрд╡рд░реНрдбреНрд╕ (рд╕рд╛рдордЧреНрд░реА рдореЗрдВ рдкреНрд░рд╛рдХреГрддрд┐рдХ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ):
рдкреНрд░рд╛рдердорд┐рдХ: ${recPrimary || ""}
рджреНрд╡рд┐рддреАрдпрдХ: ${recSecondary || ""}
рддреГрддреАрдпрдХ: ${recTertiary || ""}
рд▓реЙрдиреНрдЧ-рдЯреЗрд▓: ${recLongtail || ""}
рдЯреНрд░реЗрдВрдбрд┐рдВрдЧ: ${recTrending || ""}

рдХрдЪреНрдЪреА рдХреНрд░рд┐рдХреЗрдЯ рд╕рд╛рдордЧреНрд░реА (рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдкреБрдирд░реНрд▓реЗрдЦрди рдХрд░реЗрдВ - рдХреЙрдкреА рди рдХрд░реЗрдВ):
рд╢реАрд░реНрд╖рдХ: ${rawTitle || ""}
рд╡рд┐рд╡рд░рдг: ${rawDescription || ""}
рд╕рд╛рдордЧреНрд░реА:
${rawBody || ""}

рдЖрдЙрдЯрдкреБрдЯ рдирд┐рд░реНрджреЗрд╢:
рдПрдХ рд╡реНрдпрд╛рдкрдХ, рдЖрдХрд░реНрд╖рдХ рдХреНрд░рд┐рдХреЗрдЯ рд╕рдорд╛рдЪрд╛рд░ рд▓реЗрдЦ рд▓рд┐рдЦреЗрдВ рдЬреЛ:
тЬУ рд╕рд╛рдзрд╛рд░рдг рдкреБрдирд░реНрд▓реЗрдЦрди рд╕реЗ рдЖрдЧреЗ рдХрдерд╛ рдХреЛ рдКрдВрдЪрд╛ рдЙрдард╛рддрд╛ рд╣реИ
тЬУ рд╡рд┐рд╢реЗрд╖ рдореВрд▓реНрдп рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ (рдЖрдВрдХрдбрд╝реЗ, рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рд░рд╛рдп, рд╕реЛрд╢рд▓ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ)
тЬУ рдкреНрд░рд╛рдХреГрддрд┐рдХ, рдорд╛рдирд╡реАрдп рд▓реЗрдЦрди рдХреЗ рд╕рд╛рде AI рдбрд┐рдЯреЗрдХреНрд╢рди рдЯреВрд▓реНрд╕ рдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИ
тЬУ рд╕рднреА 5 рдХреАрд╡рд░реНрдбреНрд╕ рдХрд╛ рд╕рд╛рдордЧреНрд░реА рдореЗрдВ рдкреНрд░рд╛рдХреГрддрд┐рдХ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ
тЬУ рджрд┐рдП рдЧрдП рдЖрдЙрдЯрд▓рд╛рдЗрди рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдкрд╛рд▓рди рдХрд░рддрд╛ рд╣реИ
тЬУ рд╡рд┐рд╡рд┐рдз рдЕрдиреБрднрд╛рдЧ рдЧрд╣рд░рд╛рдИ рдХреЗ рд╕рд╛рде 1000-1500 рд╢рдмреНрдж рд╣реИ
тЬУ рдпрдерд╛рд░реНрдерд╡рд╛рджреА рд╕реЛрд╢рд▓ рдореАрдбрд┐рдпрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ
тЬУ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдФрд░ рд╕рд╛рдВрдЦреНрдпрд┐рдХреАрдп рд╕рдВрджрд░реНрдн рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ
тЬУ рдкрд╛рдардХреЛрдВ рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдЖрдХрд░реНрд╖рдХ рдХрд╣рд╛рдиреА рдХрд╣рд╛рдиреА рдмрдирд╛рддрд╛ рд╣реИ
тЬУ рдкреЗрд╢реЗрд╡рд░ рдкрддреНрд░рдХрд╛рд░рд┐рддрд╛ рдорд╛рдирдХреЛрдВ рдХреЛ рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИ

рдЕрднреА рд▓рд┐рдЦрдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ - рдХреЗрд╡рд▓ HTML рдмреЙрдбреА рд╕рд╛рдордЧреНрд░реА, рдФрд░ рдХреБрдЫ рдирд╣реАрдВред
`.trim();
}

/* ---------- MAIN PROCESSING FUNCTION ---------- */

async function processHindiCricketNewsOpenAI(input, options = {}) {
  const startTime = Date.now();
  
  try {
    console.log('ЁЯПП [Hindi Cricket OpenAI] Processing Hindi cricket article:', input.title);
    console.log('ЁЯУЭ [Hindi Cricket OpenAI] Original content length:', input.content?.length || 0);
    console.log('ЁЯУД [Hindi Cricket OpenAI] Original content preview:', input.content?.substring(0, 200) + '...');
    
    if (!input.title || input.title.length < 10) {
      throw new Error('Title too short');
    }
    if (!input.description || input.description.length < 20) {
      throw new Error('Description too short');
    }
    if (!input.content || input.content.length < 300) {
      throw new Error('Content too short');
    }

    // 1) Generate SEO recommendations
    console.log('ЁЯУЛ [Hindi Cricket OpenAI] Generating SEO recommendations...');
    const prePrompt = buildHindiCricketPrePublishPrompt({
      title: input.title || "",
      description: input.description || "",
      body: input.content || "",
    });
    const recText = await generateWithOpenAI(prePrompt, { temperature: 0.2, max_tokens: 1200 });
    const recs = parseHindiPrePublishTextToJSON(recText);
    console.log('тЬЕ [Hindi Cricket OpenAI] SEO recommendations generated');

    // 2) Generate enhanced Hindi cricket article
    console.log('тЬНя╕П [Hindi Cricket OpenAI] Generating enhanced Hindi cricket article...');
    const bodyPrompt = buildHindiCricketRewriteBodyHtmlPrompt({
      rawTitle: input.title || "",
      rawDescription: input.description || "",
      rawBody: input.content || "",
      recTitle: recs.recommendedTitle,
      recMeta: recs.recommendedMeta,
      recOutline: recs.outline,
      recPrimary: recs.keywords?.primary || "",
      recSecondary: recs.keywords?.secondary || "",
      recTertiary: recs.keywords?.tertiary || "",
      recLongtail: recs.keywords?.longtail || "",
      recTrending: recs.keywords?.trending || "",
    });
    const bodyHtml = await generateWithOpenAI(bodyPrompt, { temperature: 0.7, max_tokens: 5000 });
    console.log('тЬЕ [Hindi Cricket OpenAI] Enhanced Hindi cricket article generated');

    return {
      success: true,
      readyToPublishArticle: bodyHtml,
      recommendations: recs,
      processingTime: Date.now() - startTime
    };

  } catch (error) {
    console.error('Process Hindi cricket news OpenAI error:', error);
    return {
      success: false,
      error: error.message,
      processingTime: Date.now() - startTime
    };
  }
}

/* ---------- PARSERS & HELPERS ---------- */

function parseHindiPrePublishTextToJSON(text = "") {
  const get = (re) => {
    const m = text.match(re);
    return m ? m[1].trim() : "";
  };

  let recommendedTitle = get(/RECOMMENDED TITLE:\s*([^\n]+)/i);
  let recommendedMeta  = get(/RECOMMENDED META DESCRIPTION:\s*([^\n]+)/i);
  let recommendedSlug  = get(/RECOMMENDED SLUG:\s*([^\n]+)/i);
  let outline          = get(/OUTLINE:\s*([\s\S]*?)(?:\n5\)|\nKEYWORDS:|$)/i);
  
  // Parse all 5 keywords
  let primary   = get(/Primary:\s*([^\n]+)/i);
  let secondary = get(/Secondary:\s*([^\n]+)/i);
  let tertiary  = get(/Tertiary:\s*([^\n]+)/i);
  let longtail  = get(/Long-tail:\s*([^\n]+)/i);
  let trending  = get(/Trending:\s*([^\n]+)/i);

  // Fallbacks
  if (!recommendedTitle) recommendedTitle = "рдХреНрд░рд┐рдХреЗрдЯ рдЕрдкрдбреЗрдЯ";
  if (!recommendedMeta)  recommendedMeta  = "рдирд╡реАрдирддрдо рдХреНрд░рд┐рдХреЗрдЯ рдЕрдкрдбреЗрдЯред";
  if (!recommendedSlug)  recommendedSlug  = recommendedTitle;
  if (!outline)          outline          = "H2: рдореИрдЪ рд╕рд╛рд░рд╛рдВрд╢\nH3: рдореБрдЦреНрдп рдХреНрд╖рдг";
  if (!primary)          primary          = "рдХреНрд░рд┐рдХреЗрдЯ";
  if (!secondary)        secondary        = "рдЦреЗрд▓";
  if (!tertiary)         tertiary         = "рдореИрдЪ";
  if (!longtail)         longtail         = "рдХреНрд░рд┐рдХреЗрдЯ рд╕рдорд╛рдЪрд╛рд░";
  if (!trending)         trending         = "рдХреНрд░рд┐рдХреЗрдЯ рдЕрдкрдбреЗрдЯ";

  return {
    recommendedTitle: recommendedTitle.slice(0, 65),
    recommendedMeta:  recommendedMeta.slice(0, 160),
    recommendedSlug:  recommendedSlug.toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/^-+|-+$/g, ""),
    outline,
    keywords: { 
      primary: primary || "", 
      secondary: secondary || "", 
      tertiary: tertiary || "",
      longtail: longtail || "",
      trending: trending || ""
    },
  };
}

function buildHindiCricketHtmlDocument({ title, metaDescription, bodyHtml }) {
  const safeTitle = (title || "").slice(0, 60);
  const safeMeta  = (metaDescription || "").slice(0, 160);
  const body      = /<(h1|p|h2|h3|ul|li|blockquote|strong|em)\b/i.test(bodyHtml || "")
    ? bodyHtml
    : `<h1>${safeTitle || "рдХреНрд░рд┐рдХреЗрдЯ рдЕрдкрдбреЗрдЯ"}</h1><p>${safeMeta || ""}</p>`;

  return [
    "<!doctype html>",
    '<html lang="hi">',
    "<head>",
    '  <meta charset="utf-8" />',
    '  <meta name="viewport" content="width=device-width, initial-scale=1" />',
    `  <title>${safeTitle}</title>`,
    `  <meta name="description" content="${safeMeta}" />`,
    '  <meta name="keywords" content="рдХреНрд░рд┐рдХреЗрдЯ, рдЦреЗрд▓, рд╕рдорд╛рдЪрд╛рд░, рд╡рд┐рд╢реНрд▓реЗрд╖рдг, рдЯрд┐рдкреНрдкрдгреА" />',
    '  <meta name="author" content="рдХреНрд░рд┐рдХреЗрдЯ рдиреНрдпреВрдЬрд╝ рдЯреАрдо" />',
    '  <meta property="og:title" content="' + safeTitle + '" />',
    '  <meta property="og:description" content="' + safeMeta + '" />',
    '  <meta property="og:type" content="article" />',
    "</head>",
    "<body>",
    body,
    "</body>",
    "</html>",
  ].join("\n");
}

async function generateHindiCricketHeadline(title) {
  const prompt = `рдЗрд╕ рдХреНрд░рд┐рдХреЗрдЯ рд╕рдорд╛рдЪрд╛рд░ рд╢реАрд░реНрд╖рдХ рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрдХрд░реНрд╖рдХ, SEO-рдЕрдиреБрдХреВрд▓ рдХреНрд░рд┐рдХреЗрдЯ рд╣реЗрдбрд▓рд╛рдЗрди рд╣рд┐рдВрджреА рдореЗрдВ рдмрдирд╛рдПрдВред рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рдмрдирд╛рдПрдВ:
1. рдЖрдХрд░реНрд╖рдХ рдФрд░ рдХреНрд░рд┐рдХреЗрдЯ-рдХреЗрдВрджреНрд░рд┐рдд
2. рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ рддреЛ 60 рд╡рд░реНрдгреЛрдВ рд╕реЗ рдХрдо
3. рдХреНрд░рд┐рдХреЗрдЯ рдХреАрд╡рд░реНрдбреНрд╕ рдФрд░ рд╢рдмреНрджрд╛рд╡рд▓реА рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ
4. рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХреНрд░рд┐рдХреЗрдЯ рд╕рдорд╛рдЪрд╛рд░ рд╣реЗрдбрд▓рд╛рдЗрди рдХреА рддрд░рд╣ рд▓рдЧреЗ
5. рдХреНрд░рд┐рдХреЗрдЯ рдкреНрд░рд╢рдВрд╕рдХреЛрдВ рдХреЗ рд▓рд┐рдП рдЖрдХрд░реНрд╖рдХ рдмрдирд╛рдПрдВ, рдХреНрд▓рд┐рдХрдмреЗрдЯ рд╕реЗ рдмрдЪреЗрдВ

рдореВрд▓ рдХреНрд░рд┐рдХреЗрдЯ рд╢реАрд░реНрд╖рдХ: ${title}

рдирдпрд╛ рдХреНрд░рд┐рдХреЗрдЯ рд╣реЗрдбрд▓рд╛рдЗрди рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВ:`;

  try {
    const response = await generateWithOpenAI(prompt, {
      model: "gpt-4o-mini",
      temperature: 0.8,
      max_tokens: 100
    });
    return response || title;
  } catch (error) {
    console.error('Generate Hindi cricket headline error:', error);
    return title;
  }
}

async function generateHindiCricketMetaDescription(description) {
  const prompt = `рдЗрд╕ рдХреНрд░рд┐рдХреЗрдЯ рд╕рдорд╛рдЪрд╛рд░ рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрдХрд░реНрд╖рдХ рдХреНрд░рд┐рдХреЗрдЯ рдореЗрдЯрд╛ рд╡рд┐рд╡рд░рдг рд╣рд┐рдВрджреА рдореЗрдВ рдмрдирд╛рдПрдВред рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рдмрдирд╛рдПрдВ:
1. 150-160 рд╡рд░реНрдг рд▓рдВрдмрд╛
2. рдореБрдЦреНрдп рдХреНрд░рд┐рдХреЗрдЯ рдЬрд╛рдирдХрд╛рд░реА рдФрд░ рдХреАрд╡рд░реНрдбреНрд╕ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ
3. рдХреНрд░рд┐рдХреЗрдЯ рдкреНрд░рд╢рдВрд╕рдХреЛрдВ рдХреЗ рд▓рд┐рдП рдЖрдХрд░реНрд╖рдХ
4. рдореБрдЦреНрдп рдХреНрд░рд┐рдХреЗрдЯ рдмрд┐рдВрджреБрдУрдВ рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢ рджреЗрдВ
5. рдкреНрд░рд╛рдХреГрддрд┐рдХ рдФрд░ рдХреНрд░рд┐рдХреЗрдЯ-рдХреЗрдВрджреНрд░рд┐рдд рд▓рдЧреЗ

рдореВрд▓ рдХреНрд░рд┐рдХреЗрдЯ рд╡рд┐рд╡рд░рдг: ${description}

рдХреНрд░рд┐рдХреЗрдЯ рдореЗрдЯрд╛ рд╡рд┐рд╡рд░рдг рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВ:`;

  try {
    const response = await generateWithOpenAI(prompt, {
      model: "gpt-4o-mini",
      temperature: 0.7,
      max_tokens: 200
    });
    return response || description;
  } catch (error) {
    console.error('Generate Hindi cricket meta description error:', error);
    return description;
  }
}

module.exports = {
  processHindiCricketNewsOpenAI,
  generateHindiCricketHeadline,
  generateHindiCricketMetaDescription,
  buildHindiCricketHtmlDocument,
  fetchHindiCricketStats,
  generateHindiExpertOpinion,
  generateHindiSocialMediaReactions,
};